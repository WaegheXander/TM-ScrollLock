<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/style.css" />
    <style>
      #div1 {
        width: 350px;
        height: 70px;
        padding: 10px;
        border: 1px solid #aaaaaa;
      }
    </style>
    <script>
      const fetchPromis = function (url) {
        return fetch(url)
          .then((response) => {
            console.info('Data fetched');
            let res = response.json();
            return res;
          })
          .catch((error) => {
            console.error(error);
          });
      };

      const init = function () {
        showWall();
      };

      document.addEventListener('DOMContentLoaded', init);

      function allowDrop(ev) {
        ev.preventDefault();
      }

      function drag(ev) {
        ev.dataTransfer.setData('text', ev.target.id);
      }

      function drop(ev) {
        var data = ev.dataTransfer.getData('text');
        ev.target.appendChild(document.getElementById(data));
        ev.preventDefault();
      }

      const showWall = function () {
        let html = '';
        for (let i = 0; i < 1420; i++) {
          html += '<div class="c-wall__grid--item" ondrop="drop(event)" ondragover="allowDrop(event)"><div></div></div>';
        }
        document.querySelector('.js-wall').innerHTML = html;
        console.info('Grid loaded');

        showGrips();
      };

      const showGrips = async function () {
        routes = await fetchPromis('https://func-westeur-klimapp2.azurewebsites.net/api/rope/1/routes');
        wall = document.querySelectorAll('.c-wall');
        wallItem = document.querySelectorAll('.c-wall__grid--item');

        for (let i = 0; i < routes.length; i++) {
          for (let j = 0; j < routes[i].grips.length; j++) {
            let index = routes[i].grips[j].points.x - 1 + (routes[i].grips[j].points.y - 1) * 20;
            wallItem[index].classList.add('c-wall__grid--item--grip');
            wallItem[index].setAttribute('draggable', 'true');
            wallItem[index].setAttribute('ondragstart', 'drag(event)');
          }
        }
      };
    </script>
  </head>
  <body>
    <div class="c-dashboard__main">
      <div class="c-db-wall">
        <div class="c-wall js-wall"></div>
      </div>
    </div>
    <div id="div1" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
    <div id="div2" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
    <br />
    <p id="drag3" draggable="true">This is a draggable paragraph. Drag this element into the rectangle.</p>
  </body>
</html>
